üåä WINDSURF RULES ‚Äî Language Learning App (AUTHORITATIVE)

This file defines how coding agents (Cascade, etc.) must operate on this project.

This file is **binding**.
If a rule is violated, the work is considered **NOT DONE**, regardless of intent.

---

## Conflict Resolution Order (NON-NEGOTIABLE)

1. `/docs/contract.md` wins
2. This file (`.windsurfrules.md`) wins
3. Agent suggestions lose

Agents may not override, reinterpret, or weaken these rules.

---

# PART A ‚Äî UNIVERSAL EXECUTION RULES

(Apply to ALL work on this repo)

---

## 1. Required Acknowledgment (Every Session)

Before proposing **any change**, the agent must explicitly acknowledge it has read:

1. `/docs/contract.md`
2. `.windsurfrules.md` (this file)

No acknowledgment ‚Üí no work.

---

## 2. Gated Execution Model (MANDATORY)

All work proceeds in **explicit phases**, one at a time.

### Allowed Phases
- **Phase 0 ‚Äî Diagnosis**
- **Phase 1 ‚Äî Design**
- **Phase 2 ‚Äî Implementation**
- **Phase 3 ‚Äî Verification**
- **STOP**

### Rules
- One phase at a time
- A phase must pass its gate before moving forward
- If a gate fails, fix it before proceeding
- The agent must stop after Phase 3 and wait

### Forbidden
- Skipping phases
- Bundling unrelated fixes
- ‚ÄúWhile I‚Äôm here‚Äù changes
- Asking decision questions unless explicitly requested
- Declaring progress beyond the active phase

---

## 3. Definition of DONE (STRICT)

An agent may claim **DONE** only when **all** are true:

### Code Quality
- `npm run build` ‚Üí PASS
- `npm run lint` ‚Üí PASS  
  (Markdown warnings allowed; TS/JS errors are not)

### Runtime Safety
- Zero console errors introduced by agent changes
- No runtime warnings caused by agent changes

### Validation Reality
- **Agents do NOT claim browser validation**
- Manual validation is performed by the human
- Agent must:
  - describe what to validate
  - explain expected vs actual outcomes
  - stop and wait for screenshots or confirmation

If screenshots are missing ‚Üí **NOT DONE** (but not a violation).

---

## 4. Mobile-First Invariant (CRITICAL)

All UI decisions are validated in this order:

1. **375px** ‚Äî phone baseline (must work FIRST)
2. 768px ‚Äî tablet
3. 1024px ‚Äî desktop

Rules:
- Touch targets ‚â• 48√ó48px
- Primary actions ‚â• 56√ó56px
- No hover-only interactions
- Content must remain readable at arm‚Äôs length

---

## 5. TypeScript Rules (NO EXCEPTIONS)

- ‚ùå `any` is forbidden
- `unknown` allowed only with explicit narrowing
- All persisted data must have types
- All cross-component props must have interfaces
- Props interfaces defined **above** components
- Domain types live **outside UI folders**

Type safety regressions invalidate DONE.

---

## 6. React & App Patterns (MANDATORY)

- Navigation: `useNavigate()` only  
  ‚ùå Never `window.location`
- Async logic must expose:
  - loading state
  - error state
- Errors must have:
  - user-safe UI message
  - technical console detail

---

## 7. Refactor Safety (UNIVERSAL)

- Never refactor behavior without locking it first
  (tests, invariants, or explicit guarantees)
- One refactor goal per branch
- Preserve public APIs until consumers migrate
- Prefer adapters over rewrites

Forbidden:
- Opportunistic cleanup
- Multi-concern PRs
- Silent behavior changes

---

# PART B ‚Äî PROJECT-SPECIFIC RULES  
(Language Learning App ONLY)

---

## 8. Canonical Content Model (LOCKED)

The app supports **exactly four** content types, in this order:

1. `word`
2. `sentence`
3. `dialog`
4. `passage`

Rules:
- ‚ùå ‚ÄúPhrase(s)‚Äù is forbidden ‚Äî use **Sentence**
- Order is fixed everywhere (UI, APIs, storage, practice)
- Dialogs must be multi-turn (‚â•2 turns)
- A single sentence rendered as a dialog is a bug
- A single sentence rendered as a passage is a bug

---

## 9. Vocabulary System (AUTHORITATIVE)

‚ÄúMy Vocabulary‚Äù is a **review hub**, not a flat list.

Required flow:
1. Choose **Practice** or **Archive**
2. Choose content type (Word / Sentence / Dialog / Passage)
3. View list
4. Open item detail

Rules:
- Items must always show **where they are saved**
  (Practice or Archive)
- Items must be movable:
  - Practice ‚Üî Archive
- Items must be deletable from detail view
- Saving must never dead-end the user

---

## 10. Sentence-Specific Save Rules (CRITICAL)

Sentences behave differently than words.

Rules:
- Example sentences must be **collapsed by default**
- Each sentence has its **own save state**
- If saved, UI must show:
  - ‚ÄúSaved to Practice‚Äù or ‚ÄúSaved to Archive‚Äù
- Users must be able to:
  - move a sentence between Practice ‚Üî Archive
  - delete a sentence from its saved location
- There must be **no global ‚ÄúSave Passage‚Äù button** for sentences

Violations here are **P0 bugs**.

---

## 11. Language-Scoped Data (INVARIANT)

All of the following must be scoped by active language:

- counts
- feeds
- lesson libraries
- saved vocabulary
- practice queues
- archives

Rules:
- No cross-language leakage
- Switching language must immediately update derived state
- Dependency arrays must include language

---

## 12. Language UI State (STRICT)

Rules:
- Active language must be visually unambiguous
- Only one language pill may appear active
- The active language must match:
  - data
  - layout
  - typography
  - feature gating

Mismatch = bug.

---

## 13. Arabic-Only Features (STRICTLY GATED)

Only render when `language === 'arabic'`:

- Letter breakdown
- Hebrew cognates
- Egyptian / MSA toggles

Forbidden:
- Empty placeholders in Spanish
- Executing Arabic logic in Spanish paths

---

## 14. Arabic Typography & Layout (NON-NEGOTIABLE)

Arabic rendering rules:

- Text direction: **RTL**
- Justification: **right-aligned**
- Word breakdown:
  - one word per line
  - rendered RTL
  - logical order preserved
- Font size must be:
  - comfortably readable on 375px
  - larger than Latin body text

Breaking RTL or shrinking Arabic text is a **release-blocking bug**.

---

## 15. Added Context Tile (REQUIRED)

An Added Context tile must exist in:

- Lookup results
- Lesson detail
- Exercise detail
- Vocabulary item detail

Content rules:
- Arabic:
  - root / morphology
  - Egyptian vs MSA usage
- Spanish:
  - base form / conjugation (if verb)
  - LatAm vs Spain usage

Rules:
- Must be language-aware
- Must degrade gracefully
- Must never crash on missing data

Missing tile = bug.

---

## 16. Theme Invariant (CRITICAL)

Home defines the canonical visual language.

Rules:
- Card radius, shadows, padding are canonical
- Lookup, Lessons, Vocabulary, Exercises must reuse them
- ‚ùå Black/white utility surfaces for primary content are forbidden
- Accent colors may vary by language, not base surfaces

---

## 17. Persistence Rules

- `localStorage` ‚Üí session recovery only
- Supabase ‚Üí long-term memory only

If a hook touches both:
- document why
- keep responsibilities separate

---

## 18. Documentation Discipline

Any change affecting:
- learning flow
- saving behavior
- vocabulary structure
- language handling
- practice logic
- hooks

must update:
- `README.md`
- `agents.md`
- relevant `/docs/architecture/*`

Docs are versioned system components.

---

## 19. When Unsure

If the agent is unsure:
- STOP
- Ask
- Do NOT guess

---

### This file is authoritative.